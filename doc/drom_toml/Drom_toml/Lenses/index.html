<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Lenses (drom_toml.Drom_toml.Lenses)</title><link rel="stylesheet" href="../../../_odoc_support/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.2.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../_odoc_support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">drom_toml</a> &#x00BB; <a href="../index.html">Drom_toml</a> &#x00BB; Lenses</nav><header class="odoc-preamble"><h1>Module <code><span>Drom_toml.Lenses</span></code></h1><p>Partial lenses (returns <code>option</code>) for accessing TOML structures. They make it possible to read/write deeply nested immutable values.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-lens"><a href="#type-lens" class="anchor"></a><code><span><span class="keyword">type</span> <span>('a, 'b) lens</span></span><span> = </span><span>{</span></code><ol><li id="type-lens.get" class="def record field anchored"><a href="#type-lens.get" class="anchor"></a><code><span>get : <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> option</span>;</span></code></li><li id="type-lens.set" class="def record field anchored"><a href="#type-lens.set" class="anchor"></a><code><span>set : <span><span class="type-var">'b</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> option</span>;</span></code></li></ol><code><span>}</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get"><a href="#val-get" class="anchor"></a><code><span><span class="keyword">val</span> get : <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-lens">lens</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> option</span></span></code></div><div class="spec-doc"><p>Extracts a value from some Toml data using a lens. Returns <code>Some value</code> if the underlying data matched the lens, or <code>None</code>.</p><p>Example:</p><pre class="language-ocaml"><code>utop # let toml_data = Toml.Parser.(from_string &quot;
[this.is.a.deeply.nested.table]
answer=42&quot; |&gt; unsafe);;
val toml_data : Types.table = &lt;abstr&gt;

utop # Toml.Lenses.(get toml_data (
  key &quot;this&quot; |-- table
  |-- key &quot;is&quot; |-- table
  |-- key &quot;a&quot; |-- table
  |-- key &quot;deeply&quot; |-- table
  |-- key &quot;nested&quot; |-- table
  |-- key &quot;table&quot; |-- table
  |-- key &quot;answer&quot;|-- int ));;
- : int option = Some 42</code></pre><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 4.0.0</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-set"><a href="#val-set" class="anchor"></a><code><span><span class="keyword">val</span> set : <span><span class="type-var">'b</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-lens">lens</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> option</span></span></code></div><div class="spec-doc"><p>Replaces an existing value in some Toml data using a lens. Returns <code>Some value</code> if the underlying data matched the lens, or <code>None</code>.</p><p>Example:</p><pre class="language-ocaml"><code>utop # let toml_data = Toml.Parser.(from_string &quot;
[this.is.a.deeply.nested.table]
answer=42&quot; |&gt; unsafe);;
val toml_data : Types.table = &lt;abstr&gt;

utop # let maybe_toml_data' = Toml.Lenses.(set 2015 toml_data (
  key &quot;this&quot; |-- table
  |-- key &quot;is&quot; |-- table
  |-- key &quot;a&quot; |-- table
  |-- key &quot;deeply&quot; |-- table
  |-- key &quot;nested&quot; |-- table
  |-- key &quot;table&quot; |-- table
  |-- key &quot;answer&quot;|-- int ));;
val maybe_toml_data' : Types.table option = Some &lt;abstr&gt;

utop # let (Some toml_data') = maybe_toml_data';;
val toml_data' : Types.table = &lt;abstr&gt;

utop # Toml.Printer.string_of_table toml_data';;
- : bytes = &quot;[this.is.a.deeply.nested.table]\nanswer = 2015\n&quot;</code></pre><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 4.0.0</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-update"><a href="#val-update" class="anchor"></a><code><span><span class="keyword">val</span> update : <span><span>(<span><span class="type-var">'b</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> option</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-lens">lens</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> option</span></span></code></div><div class="spec-doc"><p>Applies a function on an existing value in some Toml data. Returns <code>Some value</code> if the underlying data matched the lens, or <code>None</code>.</p><p>Example:</p><pre class="language-ocaml"><code>utop # let toml_data = Toml.Parser.(from_string &quot;
  [[table.of.mixed_values]]
  int=0
  str=\&quot;a\&quot;
  [[table.of.mixed_values]]
  str=\&quot;b\&quot;
  [[table.of.mixed_values]]
  int=3
&quot; |&gt; unsafe);;
val toml_data : Types.table = &lt;abstr&gt;

utop # let maybe_toml_data' =  Toml.Lenses.(update
  (fun ts -&gt; Some (
    List.map (fun t -&gt;
      (** Add 'int=42' to each table which doesn't already have an 'int' key *)
      if not (Types.Table.mem (Toml.key &quot;int&quot;) t) then
        Types.Table.add (Toml.key &quot;int&quot;) (Types.TInt 42) t
      else t) ts))
  toml_data
  (key &quot;table&quot; |-- table
   |-- key &quot;of&quot; |-- table
   |-- key &quot;mixed_values&quot; |-- array |-- tables));;
val maybe_toml_data' : Types.table option = Some &lt;abstr&gt;

utop # let (Some toml_data') = maybe_toml_data';;
val toml_data' : Types.table = &lt;abstr&gt;

utop # print_endline @@ Toml.Printer.string_of_table toml_data';;

[[table.of.mixed_values]]
int = 0
str = &quot;a&quot;
[[table.of.mixed_values]]
int = 42
str = &quot;b&quot;
[[table.of.mixed_values]]
int = 3
- : unit = ()</code></pre><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 4.0.0</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-compose"><a href="#val-compose" class="anchor"></a><code><span><span class="keyword">val</span> compose : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-lens">lens</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'c</span>, <span class="type-var">'a</span>)</span> <a href="#type-lens">lens</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'c</span>, <span class="type-var">'b</span>)</span> <a href="#type-lens">lens</a></span></span></code></div><div class="spec-doc"><p>Lens composition.</p><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 4.0.0</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-(|--)"><a href="#val-(|--)" class="anchor"></a><code><span><span class="keyword">val</span> (|--) : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-lens">lens</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'b</span>, <span class="type-var">'c</span>)</span> <a href="#type-lens">lens</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'c</span>)</span> <a href="#type-lens">lens</a></span></span></code></div><div class="spec-doc"><p>Flipped lens composition.</p><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 4.0.0</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-key"><a href="#val-key" class="anchor"></a><code><span><span class="keyword">val</span> key : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="../Types/index.html#type-table">Types.table</a>, <a href="../Types/index.html#type-value">Types.value</a>)</span> <a href="#type-lens">lens</a></span></span></code></div><div class="spec-doc"><p>Lens to a particular value in a table.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <span class="value">Types.Table.Key.Bad_key</span> <p>if the key contains invalid characters.</p></li></ul><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 4.0.0</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-field"><a href="#val-field" class="anchor"></a><code><span><span class="keyword">val</span> field : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>(<a href="../Types/index.html#type-table">Types.table</a>, <a href="../Types/index.html#type-table">Types.table</a>)</span> <a href="#type-lens">lens</a></span></span></code></div><div class="spec-doc"><p>Combines the <code>key</code> and <code>table</code> lenses, for the common case of nested tables.</p><ul class="at-tags"><li class="raises"><span class="at-tag">raises</span> <span class="value">Types.Table.Key.Bad_key</span> <p>if the key contains invalid characters.</p></li></ul><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 4.0.0</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-string"><a href="#val-string" class="anchor"></a><code><span><span class="keyword">val</span> string : <span><span>(<a href="../Types/index.html#type-value">Types.value</a>, string)</span> <a href="#type-lens">lens</a></span></span></code></div><div class="spec-doc"><p>Lens to a string value.</p><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 4.0.0</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bool"><a href="#val-bool" class="anchor"></a><code><span><span class="keyword">val</span> bool : <span><span>(<a href="../Types/index.html#type-value">Types.value</a>, bool)</span> <a href="#type-lens">lens</a></span></span></code></div><div class="spec-doc"><p>Lens to a boolean value.</p><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 4.0.0</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-int"><a href="#val-int" class="anchor"></a><code><span><span class="keyword">val</span> int : <span><span>(<a href="../Types/index.html#type-value">Types.value</a>, int)</span> <a href="#type-lens">lens</a></span></span></code></div><div class="spec-doc"><p>Lens to an int value.</p><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 4.0.0</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-float"><a href="#val-float" class="anchor"></a><code><span><span class="keyword">val</span> float : <span><span>(<a href="../Types/index.html#type-value">Types.value</a>, float)</span> <a href="#type-lens">lens</a></span></span></code></div><div class="spec-doc"><p>Lens to a float value.</p><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 4.0.0</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-date"><a href="#val-date" class="anchor"></a><code><span><span class="keyword">val</span> date : <span><span>(<a href="../Types/index.html#type-value">Types.value</a>, float)</span> <a href="#type-lens">lens</a></span></span></code></div><div class="spec-doc"><p>Lens to a date value.</p><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 4.0.0</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-array"><a href="#val-array" class="anchor"></a><code><span><span class="keyword">val</span> array : <span><span>(<a href="../Types/index.html#type-value">Types.value</a>, <a href="../Types/index.html#type-array">Types.array</a>)</span> <a href="#type-lens">lens</a></span></span></code></div><div class="spec-doc"><p>Lens to an array value.</p><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 4.0.0</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-table"><a href="#val-table" class="anchor"></a><code><span><span class="keyword">val</span> table : <span><span>(<a href="../Types/index.html#type-value">Types.value</a>, <a href="../Types/index.html#type-table">Types.table</a>)</span> <a href="#type-lens">lens</a></span></span></code></div><div class="spec-doc"><p>Lens to a table value.</p><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 4.0.0</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-strings"><a href="#val-strings" class="anchor"></a><code><span><span class="keyword">val</span> strings : <span><span>(<a href="../Types/index.html#type-array">Types.array</a>, <span>string list</span>)</span> <a href="#type-lens">lens</a></span></span></code></div><div class="spec-doc"><p>Lens to an array of strings.</p><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 4.0.0</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bools"><a href="#val-bools" class="anchor"></a><code><span><span class="keyword">val</span> bools : <span><span>(<a href="../Types/index.html#type-array">Types.array</a>, <span>bool list</span>)</span> <a href="#type-lens">lens</a></span></span></code></div><div class="spec-doc"><p>Lens to an array of booleans.</p><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 4.0.0</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-ints"><a href="#val-ints" class="anchor"></a><code><span><span class="keyword">val</span> ints : <span><span>(<a href="../Types/index.html#type-array">Types.array</a>, <span>int list</span>)</span> <a href="#type-lens">lens</a></span></span></code></div><div class="spec-doc"><p>Lens to an array of ints.</p><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 4.0.0</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-floats"><a href="#val-floats" class="anchor"></a><code><span><span class="keyword">val</span> floats : <span><span>(<a href="../Types/index.html#type-array">Types.array</a>, <span>float list</span>)</span> <a href="#type-lens">lens</a></span></span></code></div><div class="spec-doc"><p>Lens to an array of floats.</p><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 4.0.0</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-dates"><a href="#val-dates" class="anchor"></a><code><span><span class="keyword">val</span> dates : <span><span>(<a href="../Types/index.html#type-array">Types.array</a>, <span>float list</span>)</span> <a href="#type-lens">lens</a></span></span></code></div><div class="spec-doc"><p>Lens to an array of dates.</p><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 4.0.0</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-tables"><a href="#val-tables" class="anchor"></a><code><span><span class="keyword">val</span> tables : <span><span>(<a href="../Types/index.html#type-array">Types.array</a>, <span><a href="../Types/index.html#type-table">Types.table</a> list</span>)</span> <a href="#type-lens">lens</a></span></span></code></div><div class="spec-doc"><p>Lens to an array of tables.</p><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 4.0.0</li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-arrays"><a href="#val-arrays" class="anchor"></a><code><span><span class="keyword">val</span> arrays : <span><span>(<a href="../Types/index.html#type-array">Types.array</a>, <span><a href="../Types/index.html#type-array">Types.array</a> list</span>)</span> <a href="#type-lens">lens</a></span></span></code></div><div class="spec-doc"><p>Lens to an array of arrays.</p><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 4.0.0</li></ul></div></div></div></body></html>